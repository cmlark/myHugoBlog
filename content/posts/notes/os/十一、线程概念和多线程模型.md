---
title: 十一、线程概念和多线程模型
tags: ["操作系统"]
categories: OS学习笔记
draft: false
date: 2022-04-19T19:58:58+08:00
---

#### 1.什么是线程，为什么要引入线程

还没引入进程之前，系统中的各个程序只能串行执行。在传统的定成定义中，进程是程序的一次执行。但想实现多个功能显然不可能是由一个程序顺序处理就能实现的。如 QQ，可以同时进行视频，文字聊天，发送文件等操作。

<!--more-->

有的进程可能需要“同时”处理很多事情，而传统的进程只能串行的执行一系列程序。为此，引入了“线程”来增加进程的并发度。传统的进程是程序执行流的最小单位。引入线程后，线程成为了程序执行流的最小单位。可以把线程理解为“轻量级进程”。**线程是一个基本的 CPU 执行单元，也是程序执行流的最小单位。**

引入线程后，不仅是进程之间可以并发，进程内的**各线程之间**也可以并发，**从而进一步提升了系统的并发度，**使得一个进程内也可以并发的处理各种任务（如 QQ 视频，文字聊天，传文件）。

引入线程后，**进程**只作为**除 CPU 之外的系统资源的分配单元**（如打印机，内存地址空间等都是分配给进程的）。

#### 2.引入线程机制后的变化

[![LBjVvd.png](https://s1.ax1x.com/2022/04/19/LBjVvd.png)](https://imgtu.com/i/LBjVvd)

#### 3.线程的属性

[![LBjnbt.png](https://s1.ax1x.com/2022/04/19/LBjnbt.png)](https://imgtu.com/i/LBjnbt)

#### 4.线程的实现方式

**（1）用户级线程**

用户级线程由应用程序通过线程库来实现。所有的**线程管理工作都由应用程序负责**（包括线程切换）。用户级线程中，**线程切换可以在用户态下即可完成**，无需操作系统干预。用户看来是有多个线程，但在操作系统看来，并意识不到线程的存在（用户线程对用户不透明，对操作系统透明）。可以理解为**用户级线程就是“从用户视角能看到的线程。”**

![LBj1PS.png](https://s1.ax1x.com/2022/04/19/LBj1PS.png)

**（2）内核级线程（又可称为“内核支持的线程”）**

内核级**线程的管理工作**由**操作系统内核**完成。线程调度‘切换等工作都有内核负责，因此，**内核级现成的切换必然需要在核心态下才能完成**。可以这样理解，**内核级线程就是“从操作系统内核视看能看到的线程”**。

![LBv0eI.png](https://s1.ax1x.com/2022/04/19/LBv0eI.png)

在同时支持用户级线程和内核级线程的系统中，可采用二者组合的方式：将 n 个用户线程映射到 m 个内核级线程上（n >= m）:

![LBxIud.png](https://s1.ax1x.com/2022/04/19/LBxIud.png)

> **操作系统同只“看得见”内核级线程，因此只有内核级线程才是处理机分配的单位。**
>
> 例如：上面这个模型中，该进程由两个内核级线程，三个用户级线程。在用户看来，这个进程中有三个线程。但即使这个进程在一个拥有四核心的计算机上运行，也最多只能被分配到两个核心，最多只能有两个用户级线程并行执行。

#### 5.多线程模型

在同时支持多个用户级线程和内核级线程的系统中，有几个用户级线程映射到几个内核级线程的问题引出了“多线程模型”问题。

**（1）多对一模型**

多个用户及线程映射到一个内核级线程。每个用户进程只对应一个内核级进程。

![LDSdOJ.png](https://s1.ax1x.com/2022/04/19/LDSdOJ.png)

> 优点：用户级线程的切换在用户空间内即可完成，不需要切换到核心态，线程管理系统的开销小，效率高。
>
> 缺点：当一个用户级线程被阻塞后，整个进程都会被阻塞，并发度不高。多个线程不可以在多核处理机上并行运行。

**（2）一对一模型**

一个用户级线程映射到一个内核级线程。每个用户进程有与用户线程同数量的内核级线程。

![LDpgNq.png](https://s1.ax1x.com/2022/04/19/LDpgNq.png)

> 优点：当一个线程被阻塞后，别的线程还可以继续执行，并发能力强，多线程可以在多核处理机上并行执行。
>
> 缺点：一个用户进程会占用多个内核级线程，线程切换由操作系统内核完成，需要切换到核心态，因此线程管理的成本高，开销大。

**（3）多对多模型**

在同时支持用户级线程和内核级线程的系统中，可采用二者组合的方式：将 n 个用户线程映射到 m 个内核级线程上（n >= m）:

![LBxIud.png](https://s1.ax1x.com/2022/04/19/LBxIud.png)

> 克服了多对一模型并发度不高的缺点，又克服了一对一模型中一个用户进程占用太多内核级线程，开销太大的缺点。算是一种折中的解决方案。

#### 5.知识回顾

![](https://s1.ax1x.com/2022/04/19/LDCyYq.png)]
